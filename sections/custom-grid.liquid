{% schema %}
{
  "name": "Custom  Grid",
  "settings": [
    { "type": "product", "id": "product_1", "label": "Product 1" },
    { "type": "product", "id": "product_2", "label": "Product 2" },
    { "type": "product", "id": "product_3", "label": "Product 3" },
    { "type": "product", "id": "product_4", "label": "Product 4" },
    { "type": "product", "id": "product_5", "label": "Product 5" },
    { "type": "product", "id": "product_6", "label": "Product 6" }
  ]
}
{% endschema %}

<style>
/* --- Grid Layout --- */
.product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
  margin: 40px auto;
  max-width: 1200px;
  padding: 0 15px;
}

/* --- Product Card --- */
.product-card {
  background: #fff;
  border-radius: 12px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  transition: transform 0.2s, box-shadow 0.2s;
}
.product-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}
.product-card img {
  max-width: 100%;
  border-radius: 8px;
  margin-bottom: 15px;
}
.product-card h3 {
  font-size: 18px;
  margin-bottom: 10px;
}
.product-card p {
  font-size: 16px;
  color: #555;
  margin-bottom: 15px;
}
.product-card button {
  background: #1e1a2b;
  color: #fff;
  padding: 10px 18px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  transition: background 0.2s;
}
.product-card button:hover {
  background: #ff69b4;
}

/* --- Popup --- */
#product-popup {
  position: fixed;
  top: 0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
#product-popup.active {
  display:flex;
}
#product-popup .popup-inner {
  background:#fff;
  padding:30px;
  border-radius:12px;
  max-width:600px;
  width:90%;
  position:relative;
  box-shadow:0 8px 24px rgba(0,0,0,0.2);
  animation: popupFade 0.3s ease;
}
#product-popup h2 {
  margin-bottom:10px;
  font-size:22px;
}
#product-popup p {
  margin-bottom:15px;
  color:#444;
}
#product-popup select {
  width:100%;
  padding:8px;
  border:1px solid #ddd;
  border-radius:6px;
  margin-bottom:15px;
}
#product-popup button {
  background:#1e1a2b;
  color:#fff;
  padding:10px 16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
#product-popup button:hover {
  background:#ff69b4;
}
#close-popup {
  position:absolute;
  top:12px;
  right:12px;
  background:none;
  border:none;
  font-size:20px;
  cursor:pointer;
}

@keyframes popupFade {
  from { transform: translateY(20px); opacity:0; }
  to   { transform: translateY(0); opacity:1; }
}
</style>

<div class="product-grid">
  {% for i in (1..6) %}
    {% capture setting_id %}product_{{ i }}{% endcapture %}
    {% assign selected_handle = section.settings[setting_id] %}
    {% assign product = all_products[selected_handle] %}

    {% if product %}
      <div class="product-card" data-product-handle="{{ product.handle }}">
        {% if product.featured_image %}
          <img src="{{ product.featured_image | img_url: 'medium' }}" alt="{{ product.title }}">
        {% endif %}
        <h3>{{ product.title }}</h3>
        <p>{{ product.price | money }}</p>
        <button class="open-popup" data-handle="{{ product.handle }}">View Details</button>
      </div>
    {% endif %}
  {% endfor %}
</div>

<!-- Popup -->
<div id="product-popup">
  <div class="popup-inner">
    <button id="close-popup">âœ–</button>
    <div id="popup-details">Loading...</div>
    <button id="add-to-cart">Add to Cart</button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const popup = document.getElementById("product-popup");
  const popupDetails = document.getElementById("popup-details");
  const addToCartBtn = document.getElementById("add-to-cart");
  const closePopup = document.getElementById("close-popup");
  let selectedProductHandle = null;

  // Open popup
  document.querySelectorAll(".open-popup").forEach(btn => {
    btn.addEventListener("click", function() {
      selectedProductHandle = this.dataset.handle;

      fetch(`/products/${selectedProductHandle}.js`)
        .then(res => res.json())
        .then(product => {
          let variantOptions = "";
          if (product.variants && product.variants.length > 0) {
            variantOptions = `
              <label for="variant">Select variant:</label>
              <select id="variant-select">
                ${product.variants.map(v => `<option value="${v.id}">${v.title} - ${(v.price/100).toFixed(2)} ${Shopify.currency.active}</option>`).join("")}
              </select>
            `;
          }

          popupDetails.innerHTML = `
            <h2>${product.title}</h2>
            <p>${product.description || "No description"}</p>
            <p><strong>Price:</strong> ${(product.price/100).toFixed(2)} ${Shopify.currency.active}</p>
            ${variantOptions}
          `;
          popup.classList.add("active");
        });
    });
  });

  // Add to cart
  addToCartBtn.addEventListener("click", function() {
    const variantSelect = document.getElementById("variant-select");
    let variantId = variantSelect ? variantSelect.value : null;
    if (!variantId) { alert("Please select a variant"); return; }

    fetch("/cart/add.js", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ id: variantId, quantity: 1 })
    })
    .then(() => {
      alert("Added to cart!");
      popup.classList.remove("active");
    });
  });

  // Close popup
  closePopup.addEventListener("click", () => popup.classList.remove("active"));
});
</script>
